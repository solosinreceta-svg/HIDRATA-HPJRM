<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIDRATA-HPJRM v2.3.0 - Cálculo de Hidratación Parenteral</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --unicef-blue: #1D7BC9;
            --unicef-light-blue: #6AAAE6;
            --unicef-yellow: #FFD100;
            --unicef-white: #FFFFFF;
            --unicef-gray: #F5F5F5;
            --text-dark: #333333;
            --gradient-primary: linear-gradient(135deg, #1D7BC9 0%, #6AAAE6 100%);
            --gradient-secondary: linear-gradient(135deg, #6AAAE6 0%, #1D7BC9 100%);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --modal-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--unicef-gray);
            color: var(--text-dark);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex: 1;
        }
        
        /* Estilos del encabezado con forma asimétrica */
        header {
            background: var(--gradient-primary);
            color: var(--unicef-white);
            padding: 30px 0 80px;
            position: relative;
            clip-path: polygon(0 0, 100% 0, 100% 80%, 0 100%);
            box-shadow: var(--shadow);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            margin-left: 10px;
            font-weight: 700;
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        /* Menú hamburguesa - SIEMPRE VISIBLE */
        .menu-toggle {
            display: flex;
            flex-direction: column;
            cursor: pointer;
            z-index: 100;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .menu-toggle span {
            height: 3px;
            width: 25px;
            background-color: var(--unicef-white);
            margin: 3px 0;
            transition: 0.3s;
            transform-origin: center;
        }
        
        .menu-toggle.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .menu-toggle.active span:nth-child(2) {
            opacity: 0;
        }
        
        .menu-toggle.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        /* Modal del menú */
        .menu-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease;
        }
        
        .menu-modal.active {
            display: flex;
        }
        
        .menu-content {
            background: var(--unicef-white);
            border-radius: 20px;
            padding: 40px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--modal-shadow);
            transform: scale(0.9);
            animation: scaleIn 0.3s ease forwards;
            position: relative;
        }
        
        @keyframes scaleIn {
            to {
                transform: scale(1);
            }
        }
        
        .close-menu {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--unicef-blue);
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .close-menu:hover {
            background: var(--unicef-gray);
            transform: rotate(90deg);
        }
        
        .menu-title {
            color: var(--unicef-blue);
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .menu-items {
            list-style: none;
        }
        
        .menu-items li {
            margin-bottom: 15px;
        }
        
        .menu-items a {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--unicef-gray);
            border-radius: 12px;
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 500;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .menu-items a:hover {
            background: var(--unicef-light-blue);
            color: var(--unicef-white);
            transform: translateX(10px);
            border-color: var(--unicef-blue);
        }
        
        .menu-items i {
            margin-right: 15px;
            font-size: 1.2rem;
            width: 25px;
            text-align: center;
        }
        
        /* Formas decorativas asimétricas */
        .shape-1 {
            position: absolute;
            top: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50% 0 0 50%;
            z-index: 1;
        }
        
        .shape-2 {
            position: absolute;
            bottom: -50px;
            left: 10%;
            width: 100px;
            height: 100px;
            background: var(--unicef-yellow);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            z-index: 1;
        }
        
        /* Estilos de las secciones */
        section {
            background-color: var(--unicef-white);
            border-radius: 20px;
            padding: 30px;
            margin-top: -50px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            position: relative;
            z-index: 2;
            transition: transform 0.3s;
        }
        
        section:hover {
            transform: translateY(-5px);
        }
        
        h2 {
            color: var(--unicef-blue);
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--unicef-light-blue);
            font-weight: 600;
        }
        
        /* Estilos del formulario */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--unicef-blue);
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus {
            border-color: var(--unicef-light-blue);
            box-shadow: 0 0 0 3px rgba(106, 170, 230, 0.2);
            outline: none;
        }
        
        button {
            background: var(--gradient-primary);
            color: var(--unicef-white);
            border: none;
            padding: 14px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(29, 123, 201, 0.3);
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(29, 123, 201, 0.4);
        }
        
        .btn-secondary {
            background: var(--gradient-secondary);
        }
        
        /* Estilos de porcentajes */
        .percentage-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .percentage-btn {
            background: var(--unicef-gray);
            border: 2px solid #ddd;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .percentage-btn:hover {
            background: var(--unicef-light-blue);
            color: var(--unicef-white);
            border-color: var(--unicef-blue);
            transform: translateY(-2px);
        }
        
        .percentage-btn.active {
            background: var(--unicef-blue);
            color: var(--unicef-white);
            border-color: var(--unicef-blue);
        }
        
        .percentage-info {
            background: var(--unicef-gray);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid var(--unicef-blue);
        }
        
        /* Estilos de resultados en tarjeta */
        .results-card {
            display: none;
            margin-top: 30px;
            padding: 30px;
            background: var(--unicef-white);
            border-radius: 20px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--unicef-blue);
            position: relative;
            overflow: hidden;
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .results-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: var(--unicef-yellow);
            border-radius: 50%;
            transform: translate(30px, -30px);
            opacity: 0.2;
        }
        
        .result-title {
            color: var(--unicef-blue);
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .result-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ddd;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: var(--unicef-blue);
            margin-bottom: 5px;
        }
        
        .result-value {
            font-size: 18px;
            color: var(--text-dark);
        }
        
        .electrolyte-list {
            list-style: none;
            padding-left: 0;
        }
        
        .electrolyte-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .electrolyte-list li:last-child {
            border-bottom: none;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }
        
        .action-buttons button {
            flex: 1;
        }
        
        /* Estilos de la información */
        .info-section {
            background-color: var(--unicef-gray);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }
        
        .info-section h3 {
            color: var(--unicef-blue);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .info-section h3 i {
            margin-right: 10px;
        }
        
        /* Estilos del formulario de contacto */
        .contact-form {
            max-width: 600px;
        }
        
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            min-height: 150px;
            resize: vertical;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        textarea:focus {
            border-color: var(--unicef-light-blue);
            box-shadow: 0 0 0 3px rgba(106, 170, 230, 0.2);
            outline: none;
        }
        
        /* Estilos del pie de página */
        footer {
            background: var(--gradient-primary);
            color: var(--unicef-white);
            text-align: center;
            padding: 20px 0;
            margin-top: 30px;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .footer-logo {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .footer-text {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* Estilos para pacientes guardados */
        .saved-patients {
            margin-top: 30px;
        }
        
        .patient-card {
            background: var(--unicef-gray);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--unicef-blue);
            transition: transform 0.3s ease;
        }
        
        .patient-card:hover {
            transform: translateX(5px);
        }
        
        .patient-name {
            font-weight: 600;
            color: var(--unicef-blue);
            margin-bottom: 5px;
        }
        
        .patient-details {
            font-size: 0.9rem;
            color: var(--text-dark);
        }
        
        .patient-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .patient-actions button {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* Estilos responsive */
        @media (max-width: 768px) {
            .action-buttons {
                flex-direction: column;
            }
            
            .menu-content {
                padding: 30px 20px;
                width: 95%;
            }
            
            .header-content {
                flex-wrap: wrap;
            }
            
            .logo h1 {
                font-size: 1.5rem;
            }
            
            .percentage-options {
                grid-template-columns: 1fr;
            }
        }
        
        .hidden {
            display: none;
        }
        
        /* Animación de entrada para secciones */
        .section {
            animation: slideIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <header>
        <div class="shape-1"></div>
        <div class="shape-2"></div>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-tint logo-icon"></i>
                <h1>HIDRATA-HPJRM v2.3.0</h1>
            </div>
            <div class="menu-toggle" id="menuToggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <!-- Modal del Menú -->
    <div class="menu-modal" id="menuModal">
        <div class="menu-content">
            <button class="close-menu" id="closeMenu">
                <i class="fas fa-times"></i>
            </button>
            <h2 class="menu-title">Navegación</h2>
            <ul class="menu-items">
                <li><a href="#" data-section="calculator"><i class="fas fa-calculator"></i> Calculadora</a></li>
                <li><a href="#" data-section="info"><i class="fas fa-info-circle"></i> Información</a></li>
                <li><a href="#" data-section="contact"><i class="fas fa-envelope"></i> Contáctanos</a></li>
                <li><a href="#" data-section="patients"><i class="fas fa-users"></i> Pacientes Guardados</a></li>
            </ul>
        </div>
    </div>

    <div class="container">
        <!-- Sección de la calculadora -->
        <section id="calculator" class="section">
            <h2><i class="fas fa-calculator"></i> Calculadora de Hidratación Parenteral</h2>
            
            <form id="hydrationForm">
                <div class="form-group">
                    <label for="patientName"><i class="fas fa-user"></i> Nombre del paciente (opcional):</label>
                    <input type="text" id="patientName" placeholder="Ingrese nombre para guardar">
                </div>
                
                <div class="form-group">
                    <label for="weight"><i class="fas fa-weight"></i> Peso del paciente (kg):</label>
                    <input type="number" id="weight" step="0.1" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="height"><i class="fas fa-ruler-vertical"></i> Estatura del paciente (cm):</label>
                    <input type="number" id="height" step="0.1" min="0" required>
                </div>
                
                <div class="form-group">
                    <label for="dextroseVolume"><i class="fas fa-flask"></i> Volumen de dextrosa por m² SC (ml):</label>
                    <select id="dextroseVolume">
                        <option value="1500" selected>1500 ml/m² (Habitual)</option>
                        <option value="800">800 ml/m² (Mínimo)</option>
                        <option value="2500">2500 ml/m² (Máximo)</option>
                    </select>
                </div>
                
                <button type="submit"><i class="fas fa-calculator"></i> Calcular Hidratación Base (24h)</button>
            </form>
            
            <!-- Selección de porcentaje -->
            <div class="percentage-info">
                <p><strong>Nota:</strong> Primero calcule la hidratación base para 24 horas, luego seleccione el porcentaje deseado:</p>
            </div>
            
            <div class="percentage-options" id="percentageOptions" style="display: none;">
                <div class="percentage-btn" data-percentage="25" data-hours="6">25% - 6 horas</div>
                <div class="percentage-btn" data-percentage="33" data-hours="8">33% - 8 horas</div>
                <div class="percentage-btn" data-percentage="50" data-hours="12">50% - 12 horas</div>
                <div class="percentage-btn" data-percentage="100" data-hours="24">100% - 24 horas</div>
            </div>
            
            <div id="results" class="results-card">
                <h3 class="result-title" id="resultTitle">HIDRATACIÓN DE MANTENIMIENTO PARA 24 HORAS</h3>
                
                <div class="result-item">
                    <div class="result-label">Superficie Corporal:</div>
                    <div class="result-value" id="scResult">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Dextrosa 5%:</div>
                    <div class="result-value" id="dextroseResult">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Electrolitos:</div>
                    <div class="result-value">
                        <ul class="electrolyte-list" id="electrolytesResult">
                            <!-- Los electrolitos se insertarán aquí -->
                        </ul>
                    </div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Volumen total a administrar:</div>
                    <div class="result-value" id="totalVolumeResult">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Ritmo de infusión:</div>
                    <div class="result-value" id="infusionRateResult">-</div>
                </div>
                
                <div class="result-item">
                    <div class="result-label">Goteo:</div>
                    <div class="result-value" id="dripRateResult">-</div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn-secondary" id="savePatient"><i class="fas fa-save"></i> Guardar Paciente</button>
                    <button id="newCalculation"><i class="fas fa-redo"></i> Nuevo Cálculo</button>
                </div>
            </div>
        </section>
        
        <!-- Sección de información -->
        <section id="info" class="section hidden">
            <h2><i class="fas fa-info-circle"></i> Información sobre Hidratación Parenteral</h2>
            
            <div class="info-section">
                <h3><i class="fas fa-question-circle"></i> ¿Qué es la hidratación parenteral de mantenimiento?</h3>
                <p>La hidratación parenteral de mantenimiento es una terapia intravenosa utilizada para proporcionar líquidos y electrolitos a pacientes que no pueden recibir nutrición e hidratación por vía oral.</p>
            </div>
            
            <div class="info-section">
                <h3><i class="fas fa-calculator"></i> ¿Cómo se realiza el cálculo?</h3>
                <p>La aplicación calcula primero la hidratación base para 24 horas usando la fórmula: (Peso en kg × 4 + 7) / (90 + Peso en kg).</p>
                <p>Luego determina el volumen de dextrosa al 5% según el valor seleccionado (entre 800-2500 ml/m²).</p>
                <p>Los electrolitos se calculan según las dosis establecidas:</p>
                <ul>
                    <li>Cloruro de sodio: 2 mEq/kg/día o 30-40 mEq/m²SC/día</li>
                    <li>Cloruro de potasio: 2 mEq/kg/día</li>
                    <li>Gluconato de calcio 10%: 0.5 ml/kg/día</li>
                    <li>Sulfato de magnesio 10%: 0.3 ml/kg/día</li>
                </ul>
                <p><strong>NUEVO:</strong> Una vez calculada la base para 24 horas, puede seleccionar el porcentaje deseado:</p>
                <ul>
                    <li><strong>25%</strong> - Para 6 horas</li>
                    <li><strong>33%</strong> - Para 8 horas</li>
                    <li><strong>50%</strong> - Para 12 horas</li>
                    <li><strong>100%</strong> - Para 24 horas (completo)</li>
                </ul>
                <p>El ritmo de infusión y goteo se ajustan automáticamente según el porcentaje seleccionado.</p>
                <p><strong>NOTA:</strong> Las ámpulas de electrolitos son de 10 ml de dilución. Las concentraciones utilizadas son:</p>
                <ul>
                    <li>Cloruro de sodio: 3.42 mEq/ml</li>
                    <li>Cloruro de potasio: 2.5 mEq/ml</li>
                    <li>Gluconato de calcio 10%: 1 ml/ml (10% = 100 mg/ml)</li>
                    <li>Sulfato de magnesio 10%: 1 ml/ml (10% = 100 mg/ml)</li>
                </ul>
            </div>
            
            <div class="info-section">
                <h3><i class="fas fa-exclamation-triangle"></i> Consideraciones importantes</h3>
                <ul>
                    <li>El magnesio siempre debe ser la mitad del calcio</li>
                    <li>El sodio es aproximadamente la mitad del potasio</li>
                    <li>Los frascos de dextrosa de 500ml pueden requerir dividir la hidratación cada 12 horas</li>
                    <li>Estos cálculos son para mantenimiento, no para corrección de déficits</li>
                    <li>Siempre verificar las necesidades individuales del paciente</li>
                    <li>Las ámpulas de electrolitos son de 10 ml de dilución</li>
                </ul>
            </div>
        </section>
        
        <!-- Sección de contacto -->
        <section id="contact" class="section hidden">
            <h2><i class="fas fa-envelope"></i> Contáctanos</h2>
            
            <div class="info-section">
                <p>Si tienes preguntas, sugerencias o necesitas asistencia con la aplicación, no dudes en contactarnos.</p>
                <p>Puedes enviarnos un correo electrónico directamente a: <a href="mailto:asistentepediatrico2025@gmail.com?subject=Consulta%20HIDRATA-HPJRM&body=Hola,%20me%20gustaría%20obtener%20más%20información%20sobre..." class="email-link">asistentepediatrico2025@gmail.com</a></p>
            </div>
            
            <form class="contact-form" id="contactForm">
                <div class="form-group">
                    <label for="name"><i class="fas fa-user"></i> Nombre:</label>
                    <input type="text" id="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email"><i class="fas fa-envelope"></i> Correo electrónico:</label>
                    <input type="email" id="email" required>
                </div>
                
                <div class="form-group">
                    <label for="message"><i class="fas fa-comment"></i> Mensaje:</label>
                    <textarea id="message" required></textarea>
                </div>
                
                <button type="submit"><i class="fas fa-paper-plane"></i> Enviar Mensaje</button>
            </form>
        </section>
        
        <!-- Sección de pacientes guardados -->
        <section id="patients" class="section hidden">
            <h2><i class="fas fa-users"></i> Pacientes Guardados</h2>
            
            <div class="info-section">
                <p>Aquí puedes ver y gestionar los pacientes que has guardado anteriormente.</p>
            </div>
            
            <div class="saved-patients" id="savedPatientsList">
                <!-- Los pacientes guardados se insertarán aquí -->
            </div>
        </section>
    </div>

    <footer>
        <div class="container footer-content">
            <div class="footer-logo">HIDRATA-HPJRM v2.3.0</div>
            <div class="footer-text">DESARROLLADO EN EL HPJRM. 2025</div>
        </div>
    </footer>

    <script>
        // Elementos del DOM
        const menuToggle = document.getElementById('menuToggle');
        const menuModal = document.getElementById('menuModal');
        const closeMenu = document.getElementById('closeMenu');
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.menu-items a');
        const hydrationForm = document.getElementById('hydrationForm');
        const percentageOptions = document.getElementById('percentageOptions');
        const resultsDiv = document.getElementById('results');
        const savePatientBtn = document.getElementById('savePatient');
        const newCalculationBtn = document.getElementById('newCalculation');
        const contactForm = document.getElementById('contactForm');
        const savedPatientsList = document.getElementById('savedPatientsList');
        
        // Almacenamiento de pacientes
        let savedPatients = JSON.parse(localStorage.getItem('savedPatients')) || [];
        let currentCalculation = null;
        let baseCalculation24h = null;
        
        // Concentraciones de electrolitos (mEq/ml)
        const ELECTROLYTE_CONCENTRATIONS = {
            sodium: 3.42,  // Cloruro de sodio 3.42 mEq/ml
            potassium: 2.5, // Cloruro de potasio 2.5 mEq/ml
            calcium: 1,     // Gluconato de calcio 10% (1 ml/ml)
            magnesium: 1    // Sulfato de magnesio 10% (1 ml/ml)
        };
        
        // Tamaño de las ámpulas (ml)
        const AMPULE_SIZE = 10;
        
        // Inicializar la aplicación
        function initApp() {
            // Mostrar pacientes guardados si existen
            displaySavedPatients();
            
            // Configurar navegación
            setupNavigation();
            
            // Configurar formularios
            setupForms();
            
            // Configurar botones de porcentaje
            setupPercentageButtons();
        }
        
        // Configurar navegación
        function setupNavigation() {
            // Abrir modal del menú
            menuToggle.addEventListener('click', () => {
                menuToggle.classList.add('active');
                menuModal.classList.add('active');
                document.body.style.overflow = 'hidden';
            });
            
            // Cerrar modal del menú
            closeMenu.addEventListener('click', closeModal);
            
            // Cerrar modal al hacer clic fuera
            menuModal.addEventListener('click', (e) => {
                if (e.target === menuModal) {
                    closeModal();
                }
            });
            
            // Cerrar modal con ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && menuModal.classList.contains('active')) {
                    closeModal();
                }
            });
            
            // Navegación entre secciones
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetSection = link.getAttribute('data-section');
                    navigateToSection(targetSection);
                });
            });
            
            function closeModal() {
                menuToggle.classList.remove('active');
                menuModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
            
            function navigateToSection(targetSection) {
                // Ocultar todas las secciones
                sections.forEach(section => {
                    section.classList.add('hidden');
                });
                
                // Mostrar la sección seleccionada
                document.getElementById(targetSection).classList.remove('hidden');
                
                // Cerrar el modal
                closeModal();
                
                // Si es la sección de pacientes, actualizar la lista
                if (targetSection === 'patients') {
                    displaySavedPatients();
                }
                
                // Scroll al inicio de la sección
                document.getElementById(targetSection).scrollIntoView({ behavior: 'smooth' });
            }
        }
        
        // Configurar botones de porcentaje
        function setupPercentageButtons() {
            const percentageBtns = document.querySelectorAll('.percentage-btn');
            
            percentageBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remover clase active de todos los botones
                    percentageBtns.forEach(b => b.classList.remove('active'));
                    // Agregar clase active al botón clickeado
                    btn.classList.add('active');
                    
                    // Calcular con el porcentaje seleccionado
                    const percentage = parseFloat(btn.getAttribute('data-percentage'));
                    const hours = parseInt(btn.getAttribute('data-hours'));
                    calculateWithPercentage(percentage, hours);
                });
            });
        }
        
        // Configurar formularios
        function setupForms() {
            // Cálculo de hidratación base para 24h
            hydrationForm.addEventListener('submit', (e) => {
                e.preventDefault();
                calculateBase24h();
            });
            
            // Botón para guardar paciente
            savePatientBtn.addEventListener('click', () => {
                savePatient();
            });
            
            // Botón para nuevo cálculo
            newCalculationBtn.addEventListener('click', () => {
                resetCalculator();
            });
            
            // Manejo del formulario de contacto
            contactForm.addEventListener('submit', (e) => {
                e.preventDefault();
                sendContactMessage();
            });
        }
        
        // Calcular hidratación base para 24 horas
        function calculateBase24h() {
            // Obtener valores del formulario
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const dextroseVolume = parseInt(document.getElementById('dextroseVolume').value);
            
            // Validar datos
            if (!weight || weight <= 0) {
                alert('Por favor ingrese un peso válido');
                return;
            }
            
            // Calcular superficie corporal
            const bodySurface = ((weight * 4) + 7) / (90 + weight);
            
            // Calcular volumen total de dextrosa para 24h
            const totalDextrose24h = Math.round(bodySurface * dextroseVolume);
            
            // Calcular electrolitos para 24h
            const sodium24h = Math.round(weight * 2); // mEq
            const potassium24h = Math.round(weight * 2); // mEq
            const calcium24h = Math.round(weight * 0.5); // ml
            const magnesium24h = Math.round(weight * 0.3); // ml
            
            // Ajustar según las relaciones establecidas
            // Magnesio debe ser la mitad del calcio
            const adjustedMagnesium24h = Math.round(calcium24h / 2);
            // Sodio debe ser aproximadamente la mitad del potasio
            const adjustedSodium24h = Math.round(potassium24h / 2);
            
            // Guardar cálculo base para 24h
            baseCalculation24h = {
                patientName: document.getElementById('patientName').value,
                weight,
                height,
                bodySurface,
                totalDextrose24h,
                sodium24h: adjustedSodium24h,
                potassium24h,
                calcium24h,
                magnesium24h: adjustedMagnesium24h,
                timestamp: new Date().toISOString()
            };
            
            // Mostrar opciones de porcentaje
            percentageOptions.style.display = 'grid';
            
            // Calcular con 100% (24 horas) por defecto
            calculateWithPercentage(100, 24);
            
            // Mostrar mensaje informativo
            alert('Cálculo base para 24 horas completado. Ahora seleccione el porcentaje deseado.');
        }
        
        // Calcular con porcentaje específico
        function calculateWithPercentage(percentage, hours) {
            if (!baseCalculation24h) {
                alert('Primero debe calcular la hidratación base para 24 horas.');
                return;
            }
            
            const factor = percentage / 100;
            
            // Calcular valores ajustados por porcentaje
            const totalDextrose = Math.round(baseCalculation24h.totalDextrose24h * factor);
            const sodium = Math.round(baseCalculation24h.sodium24h * factor);
            const potassium = Math.round(baseCalculation24h.potassium24h * factor);
            const calcium = Math.round(baseCalculation24h.calcium24h * factor);
            const magnesium = Math.round(baseCalculation24h.magnesium24h * factor);
            
            // Calcular volúmenes de electrolitos en ml
            const sodiumVolume = sodium / ELECTROLYTE_CONCENTRATIONS.sodium;
            const potassiumVolume = potassium / ELECTROLYTE_CONCENTRATIONS.potassium;
            const calciumVolume = calcium; // Ya está en ml
            const magnesiumVolume = magnesium; // Ya está en ml
            
            // Calcular número de ámpulas necesarias
            const sodiumAmpules = Math.ceil(sodiumVolume / AMPULE_SIZE);
            const potassiumAmpules = Math.ceil(potassiumVolume / AMPULE_SIZE);
            const calciumAmpules = Math.ceil(calciumVolume / AMPULE_SIZE);
            const magnesiumAmpules = Math.ceil(magnesiumVolume / AMPULE_SIZE);
            
            // Calcular ritmo de infusión
            const infusionRate = Math.round(totalDextrose / hours);
            
            // Calcular goteo (20 gotas = 1 ml)
            const dripRate = Math.round((totalDextrose * 20) / (hours * 60));
            
            // Guardar cálculo actual
            currentCalculation = {
                ...baseCalculation24h,
                percentage,
                hours,
                totalDextrose,
                sodium,
                potassium,
                calcium,
                magnesium,
                sodiumVolume,
                potassiumVolume,
                calciumVolume,
                magnesiumVolume,
                sodiumAmpules,
                potassiumAmpules,
                calciumAmpules,
                magnesiumAmpules,
                infusionRate,
                dripRate
            };
            
            // Actualizar título de resultados
            document.getElementById('resultTitle').textContent = `HIDRATACIÓN DE MANTENIMIENTO - ${percentage}% (${hours} HORAS)`;
            
            // Mostrar resultados
            document.getElementById('scResult').textContent = baseCalculation24h.bodySurface.toFixed(2) + ' m²';
            document.getElementById('dextroseResult').textContent = totalDextrose + ' ml';
            
            // Mostrar electrolitos en lista con ámpulas
            document.getElementById('electrolytesResult').innerHTML = `
                <li>Cloruro de sodio: ${sodium} mEq (${sodiumVolume.toFixed(1)} ml) - ${sodiumAmpules} ámpula(s) de 10 ml</li>
                <li>Cloruro de potasio: ${potassium} mEq (${potassiumVolume.toFixed(1)} ml) - ${potassiumAmpules} ámpula(s) de 10 ml</li>
                <li>Gluconato de calcio 10%: ${calcium} ml - ${calciumAmpules} ámpula(s) de 10 ml</li>
                <li>Sulfato de magnesio 10%: ${magnesium} ml - ${magnesiumAmpules} ámpula(s) de 10 ml</li>
            `;
            
            document.getElementById('totalVolumeResult').textContent = totalDextrose + ' ml';
            document.getElementById('infusionRateResult').textContent = infusionRate + ' ml/h';
            document.getElementById('dripRateResult').textContent = dripRate + ' gotas/minuto';
            
            // Mostrar resultados
            resultsDiv.style.display = 'block';
            resultsDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Guardar paciente
        function savePatient() {
            if (!currentCalculation) {
                alert('Primero debe realizar un cálculo antes de guardar.');
                return;
            }
            
            // Si no hay nombre, generar uno automático
            if (!currentCalculation.patientName) {
                currentCalculation.patientName = `Paciente ${savedPatients.length + 1}`;
            }
            
            // Agregar a la lista de pacientes guardados
            savedPatients.push({...currentCalculation});
            
            // Guardar en localStorage
            localStorage.setItem('savedPatients', JSON.stringify(savedPatients));
            
            // Mostrar mensaje de éxito
            alert(`Paciente "${currentCalculation.patientName}" guardado correctamente.`);
            
            // Actualizar lista de pacientes
            displaySavedPatients();
        }
        
        // Mostrar pacientes guardados
        function displaySavedPatients() {
            if (savedPatients.length === 0) {
                savedPatientsList.innerHTML = '<div class="info-section"><p>No hay pacientes guardados aún.</p></div>';
                return;
            }
            
            savedPatientsList.innerHTML = '';
            
            savedPatients.forEach((patient, index) => {
                const patientCard = document.createElement('div');
                patientCard.className = 'patient-card';
                patientCard.innerHTML = `
                    <div class="patient-name">${patient.patientName}</div>
                    <div class="patient-details">
                        <div>Peso: ${patient.weight} kg | Estatura: ${patient.height} cm</div>
                        <div>SC: ${patient.bodySurface.toFixed(2)} m² | Volumen: ${patient.totalDextrose} ml</div>
                        <div>Porcentaje: ${patient.percentage}% | Horas: ${patient.hours} h</div>
                        <div>Ritmo: ${patient.infusionRate} ml/h | Goteo: ${patient.dripRate} gotas/min</div>
                        <div>Guardado: ${new Date(patient.timestamp).toLocaleDateString()}</div>
                    </div>
                    <div class="patient-actions">
                        <button class="btn-secondary" onclick="viewPatient(${index})"><i class="fas fa-eye"></i> Ver</button>
                        <button onclick="deletePatient(${index})"><i class="fas fa-trash"></i> Eliminar</button>
                    </div>
                `;
                savedPatientsList.appendChild(patientCard);
            });
        }
        
        // Ver paciente guardado
        function viewPatient(index) {
            const patient = savedPatients[index];
            
            // Llenar el formulario con los datos del paciente
            document.getElementById('patientName').value = patient.patientName;
            document.getElementById('weight').value = patient.weight;
            document.getElementById('height').value = patient.height;
            document.getElementById('dextroseVolume').value = Math.round(patient.totalDextrose24h / patient.bodySurface);
            
            // Calcular base primero
            calculateBase24h();
            
            // Seleccionar el porcentaje correspondiente
            setTimeout(() => {
                const percentageBtn = document.querySelector(`.percentage-btn[data-percentage="${patient.percentage}"]`);
                if (percentageBtn) {
                    percentageBtn.click();
                }
            }, 100);
            
            // Navegar a la sección de calculadora
            sections.forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById('calculator').classList.remove('hidden');
        }
        
        // Eliminar paciente
        function deletePatient(index) {
            if (confirm('¿Está seguro de que desea eliminar este paciente?')) {
                savedPatients.splice(index, 1);
                localStorage.setItem('savedPatients', JSON.stringify(savedPatients));
                displaySavedPatients();
            }
        }
        
        // Resetear calculadora
        function resetCalculator() {
            hydrationForm.reset();
            percentageOptions.style.display = 'none';
            resultsDiv.style.display = 'none';
            baseCalculation24h = null;
            currentCalculation = null;
            
            // Remover clase active de todos los botones de porcentaje
            document.querySelectorAll('.percentage-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById('hydrationForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Enviar mensaje de contacto
        function sendContactMessage() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const message = document.getElementById('message').value;
            
            // Crear enlace de correo con los datos del formulario
            const subject = `Consulta HIDRATA-HPJRM de ${name}`;
            const body = `Nombre: ${name}%0D%0AEmail: ${email}%0D%0A%0D%0AMensaje:%0D%0A${message}`;
            
            // Abrir cliente de correo predeterminado
            window.location.href = `mailto:asistentepediatrico2025@gmail.com?subject=${subject}&body=${body}`;
        }
        
        // Hacer las funciones globales para los botones
        window.viewPatient = viewPatient;
        window.deletePatient = deletePatient;
        
        // Inicializar la aplicación cuando se carga la página
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
    </html>
